<!DOCTYPE html>

<meta charset="utf-8" name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

<!-- three.js library -->
<script src="../vendor/threejs/three.js"></script>
<!-- ar.js lib -->
<script src="../vendor/arjs/ar.js"></script>
<script>THREEx.ArToolkitContext.baseURL = '../'</script>
<!--obj loader-->
<script src="../vendor/MTLLoader.js"></script>
<script src="../vendor/OBJLoader.js"></script>


<head>
    <style>
        body {
            margin: 0 auto;
        }
        .dislog {
            position: fixed;
            z-index: 999;
            width: 100%;
            height: 100%;
            /*display: none;*/
            text-align: center;
            /*background-color: #000;*/
            opacity: 1;
        }
        /*状态*/

        .list {
            position: relative;
            width: 100%;
            height: 70px;
        }

        .dis_cont {
            position: relative;
            border-radius: 10px;
            top: 40%;
            width: 80%;
            display: inline-block;
            height: 160px;
            background-color: #7CE1FB;
        }
        /*确认取消*/

        .dis_bott {
            position: absolute;
            border-bottom-left-radius: 10px;
            border-bottom-right-radius: 10px;
            border-top: 1px solid #ddd;
            width: 100%;
            height: 70px;
            background-color: #f5f5f5;
            bottom: 0px;
        }
        /*取消按钮*/

        .left_name {
            position: absolute;
            border-bottom-left-radius: 10px;
            text-align: center;
            left: 0px;
            width: 50%;
            height: 70px;
            line-height: 70px;
            background-color: #fff;
        }
        /*确认*/

        .right_name {
            position: absolute;
            text-align: center;
            border-bottom-right-radius: 10px;
            right: 0px;
            width: 49%;
            height: 70px;
            line-height: 70px;
            background-color: #fff;
        }
        /* 提示*/

        .cont_dis {
            position: relative;
            border-radius: 10px;
            text-align: center;
            width: 100%;
            height: 90px;
            font-size: 20px;
            display: flex;
            align-items: center;
            color: #fff;
            box-sizing: border-box;
            padding: 20px 20px;
        }
        /**************************************xuanzhuan********************************************************/
        /* #zhezhao{
             width: 400px;
             height: 400px;
             margin: 20% auto;

             position: relative;
             -webkit-animation:run 6s linear 0s infinite;
         }*/
        /*#zhezhao{*/

        /*      margin-top: 30%;*/

        /*      -webkit-animation:run 6s linear 0s infinite;*/
        /*  }*/
        /*#zhezhao:hover{*/
        /*    -webkit-animation-play-state:paused;*/
        /*}*/


        /*@-webkit-keyframes run{*/
        /*    from{*/
        /*        -webkit-transform:rotate(0deg);*/
        /*    }*/
        /*    to{*/
        /*        -webkit-transform:rotate(360deg);*/
        /*    }*/
        /*}*/
        /***************************rotate*******************************/

    </style>
</head>


<body style='margin : 0px; overflow: hidden; font-family: Monospace;'>

<div id="back">
    <img height=50 width=50 src="images/back.png" onclick="window.open('index.html','_self')">
</div>
<!--<div>-->
<!--    <div id="zhezhao">-->
<!--        <img src="images/biankuang.png" width="100%" height="100%">-->

<!--    </div>-->
<!--</div>-->


<!--/**************************tanchuang***********************************/-->
<div id="lianwen" class="dislog" style="display:none;">
    <!--内容-->
    <div class="dis_cont">
        <div class="cont_dis">
            莲纹识别成功
        </div>

        <div class="dis_bott">
            <label class="left_name" onclick="cances()">进行AR体验</label>
            <label class="right_name" onclick="window.open('lianhua.html')">查看纹样介绍</label>

        </div>

    </div>

</div>
<div id="juancao" class="dislog" style="display:none;">
    <!--内容-->
    <div class="dis_cont">
        <div class="cont_dis">
            卷草纹识别成功
        </div>

        <div class="dis_bott">
            <label class="left_name" onclick="cances()">进行AR体验</label>
            <label class="right_name" onclick="window.open('juancao.html')">查看纹样介绍</label>

        </div>

    </div>

</div>
<div id="feitian" class="dislog" style="display:none;">
    <!--内容-->
    <div class="dis_cont">
        <div class="cont_dis">
            飞天纹识别成功
        </div>

        <div class="dis_bott">
            <label class="left_name" onclick="cances()">进行AR体验</label>
            <label class="right_name" onclick="window.open('feitianwen.html')">查看纹样介绍</label>

        </div>

    </div>

</div>
<div id="long" class="dislog" style="display:none;">
    <!--内容-->
    <div class="dis_cont">
        <div class="cont_dis">
            龙纹识别成功
        </div>

        <div class="dis_bott">
            <label class="left_name" onclick="cances()">进行AR体验</label>
            <label class="right_name" onclick="window.open('long.html')">查看纹样介绍</label>

        </div>

    </div>

</div>
<div id="bajiaoxing" class="dislog" style="display:none;">
    <!--内容-->
    <div class="dis_cont">
        <div class="cont_dis">
            八角星纹识别成功
        </div>

        <div class="dis_bott">
            <label class="left_name" onclick="cances()">进行AR体验</label>
            <label class="right_name" onclick="window.open('bajiaoxing.html')">查看纹样介绍</label>

        </div>

    </div>

</div>
<div id="ruyi" class="dislog" style="display:none;">
    <!--内容-->
    <div class="dis_cont">
        <div class="cont_dis">
            如意纹识别成功
        </div>

        <div class="dis_bott">
            <label class="left_name" onclick="cances()">进行AR体验</label>
            <label class="right_name" onclick="window.open('ruyi.html')">查看纹样介绍</label>

        </div>

    </div>

</div>
<div id="hudie" class="dislog" style="display:none;">
    <!--内容-->
    <div class="dis_cont">
        <div class="cont_dis">
            蝴蝶纹识别成功
        </div>

        <div class="dis_bott">
            <label class="left_name" onclick="cances()">进行AR体验</label>
            <label class="right_name" onclick="window.open('hudie.html')">查看纹样介绍</label>

        </div>

    </div>

</div>
<div id="wanzi" class="dislog" style="display:none;">
    <!--内容-->
    <div class="dis_cont">
        <div class="cont_dis">
            万字纹识别成功
        </div>

        <div class="dis_bott">
            <label class="left_name" onclick="cances()">进行AR体验</label>
            <label class="right_name" onclick="window.open('wanzi.html')">查看纹样介绍</label>

        </div>

    </div>

</div>
<div id="yun" class="dislog" style="display:none;">
    <!--内容-->
    <div class="dis_cont">
        <div class="cont_dis">
            云纹识别成功
        </div>

        <div class="dis_bott">
            <label class="left_name" onclick="cances()">进行AR体验</label>
            <label class="right_name" onclick="window.open('yun.html')">查看纹样介绍</label>

        </div>

    </div>

</div>
<script type="text/javascript" src="js/jquery-2.1.3.min.js" ></script>
<script>
    /********************************弹窗***************************************/
    function shows(id){
        // $(".dislog").css("display","block");
        var target=document.getElementById(id);
        if(target.style.display=="none"){
            target.style.display="";
        }else{
            target.style.display="none";
        }
    }
    //隐藏遮罩弹窗
    /* function nones(){
        $(".dislog").css("display","none");
    }*/
    //取消
    function cances()
    {
        $(".dislog").css("display","none");

    }

    //////////////////////////////////////////////////////////////////////////////////
    //		Init
    //////////////////////////////////////////////////////////////////////////////////

    var obj;
    // init renderer
    var renderer	= new THREE.WebGLRenderer({
        antialias	: true,
        alpha: true
    });
    renderer.setClearColor(new THREE.Color('lightgrey'), 0)
    renderer.setSize( 640, 480 );
    renderer.domElement.style.position = 'absolute'
    renderer.domElement.style.top = '0px'
    renderer.domElement.style.left = '0px'
    document.body.appendChild( renderer.domElement );

    // array of functions for the rendering loop
    var onRenderFcts= [];

    // init scene and camera
    var scene	= new THREE.Scene();

    //光照设置
    var light1 = new THREE.DirectionalLight(0xffffff,0.2);
    light1.position.set(0,10,10);
    var light2 = new THREE.DirectionalLight(0xffffff,0.2);
    light2.position.set(0,10,-10);
    var light3 = new THREE.DirectionalLight(0xffffff,0.2);
    light3.position.set(10,10,0);
    var light4 = new THREE.DirectionalLight(0xffffff,0.2);
    light4.position.set(-10,10,0);

    var light5 = new THREE.DirectionalLight(0xffffff,0.4);
    light5.position.set(0,40,40);

    light1.castShadow = true;
    light2.castShadow = true;
    light3.castShadow = true;
    light4.castShadow = true;
    light5.castShadow = true;
    scene.add(light1);
    scene.add(light2);
    scene.add(light3);
    scene.add(light4);
    scene.add(light5);

    //环境光设置
    var ambilight = new THREE.AmbientLight(0xffffff,0.2);
    scene.add(ambilight);

    //////////////////////////////////////////////////////////////////////////////////
    //		Initialize a basic camera
    //////////////////////////////////////////////////////////////////////////////////

    // Create a camera
    var camera = new THREE.Camera();
    scene.add(camera);

    ////////////////////////////////////////////////////////////////////////////////
    //          handle arToolkitSource
    ////////////////////////////////////////////////////////////////////////////////

    var arToolkitSource = new THREEx.ArToolkitSource({
        // to read from the webcam
        sourceType : 'webcam',

        // to read from an image
        // sourceType : 'image',
        // sourceUrl : THREEx.ArToolkitContext.baseURL + '../data/images/img.jpg',

        // to read from a video
        // sourceType : 'video',
        // sourceUrl : THREEx.ArToolkitContext.baseURL + '../data/videos/headtracking.mp4',
    })

    arToolkitSource.init(function onReady(){
        onResize()
    })

    // handle resize
    window.addEventListener('resize', function(){
        onResize()
    })
    function onResize(){
        arToolkitSource.onResizeElement()
        arToolkitSource.copyElementSizeTo(renderer.domElement)
        if( arToolkitContext.arController !== null ){
            arToolkitSource.copyElementSizeTo(arToolkitContext.arController.canvas)
        }
    }
    ////////////////////////////////////////////////////////////////////////////////
    //          initialize arToolkitContext
    ////////////////////////////////////////////////////////////////////////////////

    // create atToolkitContext
    var arToolkitContext = new THREEx.ArToolkitContext({
        cameraParametersUrl: THREEx.ArToolkitContext.baseURL + '../data/camera_para.dat',
        detectionMode: 'mono',
    })
    // initialize it
    arToolkitContext.init(function onCompleted(){
        // copy projection matrix to camera
        camera.projectionMatrix.copy( arToolkitContext.getProjectionMatrix() );
    })

    // update artoolkit on every frame
    onRenderFcts.push(function(){
        if( arToolkitSource.ready === false )	return

        arToolkitContext.update( arToolkitSource.domElement )
    })

    //读取OBJ模型
    var onProgress = function ( xhr ) {

        if ( xhr.lengthComputable ) {

            var percentComplete = xhr.loaded / xhr.total * 100;

            console.log( Math.round(percentComplete, 2) + '% downloaded' );
        }
    };
    var onError = function ( xhr ) { };
    var loadOBJbyName = function (id,markerroot,xScale,yScale,zScale) {

            var mtlLoader = new THREE.MTLLoader();

            mtlLoader.setPath( '../../obj/' );

            mtlLoader.load( id+ '.mtl', function( materials ) {

                materials.preload();

                var objLoader = new THREE.OBJLoader();

                objLoader.setMaterials( materials );

                objLoader.setPath( '../../obj/' );

                objLoader.load( id+ '.obj', function ( object ) {

                    obj=object;
                    markerroot.add( object );
                    object.position.set(0,0,0);
                    object.scale.set(xScale,yScale,zScale);

                    var axes=new THREE.AxisHelper(10);
                    markerroot.add(axes);
                }, onProgress, onError );
            });
        }


    //建立标签和模型
    ;(function(){

        //////////////////////////////////////////////////////////////////////////////
        //		markerRoot1 八角星纹
        //////////////////////////////////////////////////////////////////////////////

        // build markerControls
        var markerRoot1 = new THREE.Group
        markerRoot1.name = 'marker1'
        scene.add(markerRoot1)
        var markerControls1 = new THREEx.ArMarkerControls(arToolkitContext, markerRoot1, {
            type : 'pattern',
            patternUrl : THREEx.ArToolkitContext.baseURL + '../markerfiles/pattern-bjxw.patt',

        })


        // add a gizmo in the center of the marker
        var geometry1	= new THREE.CubeGeometry(1,1,1);
        var material1	= new THREE.MeshNormalMaterial({
            transparent : true,
            opacity: 0.5,
            side: THREE.DoubleSide
        });
        var mesh1	= new THREE.Mesh( geometry1, material1 );
        mesh1.position.y	= geometry1.parameters.height/2
        markerRoot1.add( mesh1 );

        //////////////////////////////////////////////////////////////////////////////
        //		markerRoot2 飞天纹
        //////////////////////////////////////////////////////////////////////////////

        // build markerControls
        var markerRoot2 = new THREE.Group
        markerRoot2.name = 'marker2'
        scene.add(markerRoot2)
        var markerControls2 = new THREEx.ArMarkerControls(arToolkitContext, markerRoot2, {
            type : 'pattern',
            patternUrl : THREEx.ArToolkitContext.baseURL + '../markerfiles/pattern-ftw.patt',
        })


        //////////////////////////////////////////////////////////////////////////////
        //		markerRoot3 蝴蝶纹
        //////////////////////////////////////////////////////////////////////////////

        // build markerControls
        var markerRoot3 = new THREE.Group
        markerRoot3.name = 'marker3'
        scene.add(markerRoot3)
        var markerControls3 = new THREEx.ArMarkerControls(arToolkitContext, markerRoot3, {
            type : 'pattern',
            patternUrl : THREEx.ArToolkitContext.baseURL + '../markerfiles/pattern-hdw.patt',
        })


        //////////////////////////////////////////////////////////////////////////////
        //		markerRoot4 卷草纹
        //////////////////////////////////////////////////////////////////////////////

        // build markerControls
        var markerRoot4 = new THREE.Group
        markerRoot4.name = 'marker4'
        scene.add(markerRoot4)
        var markerControls4 = new THREEx.ArMarkerControls(arToolkitContext, markerRoot4, {
            type : 'pattern',
            patternUrl : THREEx.ArToolkitContext.baseURL + '../markerfiles/pattern-jcw2.patt',
        })



        //////////////////////////////////////////////////////////////////////////////
        //		markerRoot5 莲花纹
        //////////////////////////////////////////////////////////////////////////////

        // build markerControls
        var markerRoot5 = new THREE.Group
        markerRoot5.name = 'marker5'
        scene.add(markerRoot5)
        var markerControls5 = new THREEx.ArMarkerControls(arToolkitContext, markerRoot5, {
            type : 'pattern',
            patternUrl : THREEx.ArToolkitContext.baseURL + '../markerfiles/pattern-lhw.patt',
        })


        //////////////////////////////////////////////////////////////////////////////
        //		markerRoot6 龙纹
        //////////////////////////////////////////////////////////////////////////////

        // build markerControls
        var markerRoot6 = new THREE.Group
        markerRoot6.name = 'marker6'
        scene.add(markerRoot6)
        var markerControls6 = new THREEx.ArMarkerControls(arToolkitContext, markerRoot6, {
            type : 'pattern',
            patternUrl : THREEx.ArToolkitContext.baseURL + '../markerfiles/pattern-longw.patt',
        })


        //////////////////////////////////////////////////////////////////////////////
        //		markerRoot7 如意纹
        //////////////////////////////////////////////////////////////////////////////

        // build markerControls
        var markerRoot7 = new THREE.Group
        markerRoot7.name = 'marker7'
        scene.add(markerRoot7)
        var markerControls7 = new THREEx.ArMarkerControls(arToolkitContext, markerRoot7, {
            type : 'pattern',
            patternUrl : THREEx.ArToolkitContext.baseURL + '../markerfiles/pattern-ryw.patt',
        })

        //////////////////////////////////////////////////////////////////////////////
        //		markerRoot8 万字纹
        //////////////////////////////////////////////////////////////////////////////

        // build markerControls
        var markerRoot8 = new THREE.Group
        markerRoot8.name = 'marker8'
        scene.add(markerRoot8)
        var markerControls8 = new THREEx.ArMarkerControls(arToolkitContext, markerRoot8, {
            type : 'pattern',
            patternUrl : THREEx.ArToolkitContext.baseURL + '../markerfiles/pattern-wzw.patt',
        })

        //////////////////////////////////////////////////////////////////////////////
        //		markerRoot9 云纹
        //////////////////////////////////////////////////////////////////////////////

        // build markerControls
        var markerRoot9 = new THREE.Group
        markerRoot9.name = 'marker9'
        scene.add(markerRoot9)
        var markerControls9 = new THREEx.ArMarkerControls(arToolkitContext, markerRoot9, {
            type : 'pattern',
            patternUrl : THREEx.ArToolkitContext.baseURL + '../markerfiles/pattern-yw.patt',
        })



    })()


    //识别控制
    ;(function(){
        var markerRoot1 = scene.getObjectByName('marker1')
        var markerRoot2 = scene.getObjectByName('marker2')
        var markerRoot3 = scene.getObjectByName('marker3')
        var markerRoot4 = scene.getObjectByName('marker4')
        var markerRoot5 = scene.getObjectByName('marker5')
        var markerRoot6 = scene.getObjectByName('marker6')
        var markerRoot7 = scene.getObjectByName('marker7')
        var markerRoot8 = scene.getObjectByName('marker8')
        var markerRoot9 = scene.getObjectByName('marker9')

        // var container = new THREE.Group
        // scene.add(container)

        var isFirst1 = true;
        var isFirst2 = true;
        var isFirst3 = true;
        var isFirst4 = true;
        var isFirst5 = true;
        var isFirst6 = true;
        var isFirst7 = true;
        var isFirst8 = true;
        var isFirst9 = true;


        // update container.visible and scanningSpinner visibility
        onRenderFcts.push(function(){
            if(markerRoot1.visible && isFirst1)
            {
                console.log("1111");
                shows('bajiaoxing');
                console.log("shows");
                isFirst1 = false;
            }
            if(markerRoot2.visible && isFirst2)
            {
                shows('feitian');
                isFirst2 = false;
                loadOBJbyName('feitian', markerRoot2,0.003,0.003,0.003);
            }
            if(markerRoot3.visible && isFirst3)
            {
                shows('hudie');
                isFirst3 = false;
                loadOBJbyName('hudie', markerRoot3,0.01,0.01,0.01);
            }
            if(markerRoot4.visible && isFirst4)
            {
                shows('juancao');
                isFirst4 = false;
                loadOBJbyName('juancao', markerRoot4,0.005,0.005,0.005);
            }
            if(markerRoot5.visible && isFirst5)
            {
                shows('lianwen');
                isFirst5 = false;
                loadOBJbyName('lianhua', markerRoot5,2,2,2);
            }
            if(markerRoot6.visible && isFirst6)
            {
                shows('long');
                isFirst6 = false;
                loadOBJbyName('long_1', markerRoot6,0.0005,0.0005,0.0005);
            }
            if(markerRoot7.visible && isFirst7)
            {
                shows('ruyi');
                isFirst7 = false;
            }
            if(markerRoot8.visible && isFirst8)
            {
                shows('wanzi');
                isFirst8 = false;
                loadOBJbyName('wanzi_1', markerRoot8,0.05,0.05,0.05);
            }
            if(markerRoot9.visible && isFirst9)
            {
                shows('yun');
                isFirst9 = false;
                loadOBJbyName('yun_2', markerRoot9,0.003,0.003,0.003);
            }
        })



    })()
    //////////////////////////////////////////////////////////////////////////////////
    //		render the whole thing on the page
    //////////////////////////////////////////////////////////////////////////////////

    // render the scene
    onRenderFcts.push(function(){
        renderer.render( scene, camera );
    })

    // run the rendering loop
    var lastTimeMsec= null
    requestAnimationFrame(function animate(nowMsec){
        // keep looping
        requestAnimationFrame( animate );
        // measure time
        lastTimeMsec	= lastTimeMsec || nowMsec-1000/60
        var deltaMsec	= Math.min(200, nowMsec - lastTimeMsec)
        lastTimeMsec	= nowMsec
        // call each update function
        onRenderFcts.forEach(function(onRenderFct){
            onRenderFct(deltaMsec/1000, nowMsec/1000)
        })
    })




</script>



</body>
